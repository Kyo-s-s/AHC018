# Kyo-s-s/AHC018

AHC018のコードです。
`make run`を叩くとたくさん実行してくれます。

## 考察メモ

### 1日目

- C++のサンプルを移植、Pythonでたくさん実行できるように
    ```
    500/500
    total: 261194177
    max: (2193816, '0187')
    ave: 522388.354
    min: (8383, '0347')
    ```

- とりあえず最小全域木みたいなのを作る、マンハッタン距離を重みとする + 毎回100ずつ叩く
    実行時間が見たいのでとりあえず提出 -> https://atcoder.jp/contests/ahc018/submissions/38965863 14,764,704 点
    ローカルだと遅い(TL5sを越える)ことがあったが、意外と大丈夫(Testerが重い？) 
    ```
    500/500
    total: 145620533
    max: (1453500, '0187')
    ave: 291241.066
    min: (8383, '0347')
    ```

- Cが128とかで100ずつ叩くのはバカなので、とりあえず`max(100, C * 5)`ずつ叩くように
    ```
    500/500
    total: 141921365
    max: (1017600, '0187')
    ave: 283842.73
    min: (8383, '0347')
    ```

- 隣接するGridの耐久値をメモ -> 耐久値がいくつかを推定するみたいなことをしたい
- そもそもNが高々200なので、グリッドで情報をもってBFSしながらやればよい？

### 2日目

- 隣接マスの差
    - 平均99, 最大791(seed = 0000)
    - 平均57, 最大620(seed = 0001)
    - 平均98, 最大759(seed = 0002)
    隣のマスが分かれば大体推定できる！
    - `Field`で破壊済マスを合計powerいくつで破壊したか？をメモ

    - 隣接マス - 1000 をまず叩く
    ```
    500/500
    total: 137868230
    max: (975352, '0187')
    ave: 275736.46
    min: (8383, '0347')
    ```
    - 隣接マス - 500 をまず叩く
    ```
    500/500
    total: 135814346
    max: (951428, '0187')
    ave: 271628.692
    min: (8383, '0347')
    ```
    - 隣接マス - 400 をまず叩く スコア良かったので提出 -> https://atcoder.jp/contests/ahc018/submissions/38990732 13,749,628点
    ```
    500/500
    total: 135491993
    max: (947760, '0187')
    ave: 270983.986
    min: (8383, '0347')
    ```
    - 隣接マス - 200 をまず叩く
    ```
    500/500
    total: 139370585
    max: (980080, '0187')
    ave: 278741.17
    min: (8383, '0347')
    ```

- 最小全域木っぽいの、うまくいっていない？
    - seed0187 水源2つが繋がってる！無駄！
    - 修正した
    ```
    500/500
    total: 131960329
    max: (937600, '0449')
    ave: 263920.658
    min: (8383, '0347')
    ```

- 家/水源 はまず破壊してよい
    - そこの堅さを見て、各グリッドの破壊に掛かるコストを(雑に)推定し、
      辺削除->結合させるの山のぼり
        - 初期解はサンプル + 最小全域木 でいい
        - できるだけ辺を共有したい！という気持ち
    
    - [ ] タイマー作成
    - 雑な推定がどれくらいいい感じか見る
        - Rustで実装、inデータを見て欲しいところのみ見てinデータを吐く
        - デフォルト値をいくつかのデータの平均にして、実測データは更新して、周囲4マス(8マス？)の平均にする操作を何回かする...みたいな
        - まだうまく行っていないけど...
            - 30とか40おきくらいに推定するために開けて、そこから推定する
            - 40おき(20, 60, ... ) でおいていくと25マス開けることになる、これで推定できるならお得？
    - ある頂点の隣から順に家/水位を破壊しないようにBFSして破壊していく
    - 接続は？ -> 多点スタートダイクストラ(接続してるところにはコスト0で行ける) -> 破壊済頂点のコストは0 にして...でいい？

    - 40おきでサンプリング + ならしてやるようにした
    ```
    500/500
    total: 131424894
    max: (943944, '0253')
    ave: 262849.788
    min: (23331, '0347')
    ``` 
    あまり変わってない
    - 最初のサンプリングでは500叩くように
    ```
    500/500
    total: 128490066
    max: (894676, '0187')
    ave: 256980.132
    min: (30432, '0300')
    ```
    パラメータガチャ？
    - ならすのを20回から40回に
    ```
    500/500
    total: 127000954
    max: (916756, '0187')
    ave: 254001.908
    min: (30432, '0300')
    ```

    - is_broken だいぶおかしい実装になっているので直す
    - 40おきサンプリング + 水源/家 を開けて、一番近いやつをguessにしてからならす
        - 今までは水源/家/を考慮せずにguessしてる
    - 40おきサンプリングだと無駄なところを見ているので、家から基準値以上離れてたらサボる
    パラメータガチャしてここまで出た、とりあえず提出 -> https://atcoder.jp/contests/ahc018/submissions/39069412 12,176,969点
    ```
    500/500
    total: 126296780
    max: (851768, '0238')
    ave: 252593.56
    min: (27620, '0300')
    ```
    - ジャッジは50ケースなのでだいぶぶれる...
    - これで250位相当 -> 叩き方が悪い？ 一旦叩き方弄ってみる
    - 堅いところとやわらかいところに極端に分かれている？
    - 500以下が50%位占めてる、

### 3日目
    - 細かくサンプリングするべき
    - 20幅でサンプリング -> 0, 25, 60, 120, 210, 350, 570, 960, 1600, 2800, 5000 の順で叩く(guessを使わない) で 
    ```
    500/500
    total: 115730666
    max: (1078022, '0449')
    ave: 231461.332
    min: (48975, '0482')
    ```
    だいぶよさそう、一旦提出 -> https://atcoder.jp/contests/ahc018/submissions/39071970, 10,564,394 点

    - 高い(2500以上とか？)はサンプリング途中でやめる
    - 隣接マスの-1から叩く
    ```
    500/500
    total: 93040497
    max: (855775, '0449')
    ave: 186080.994
    min: (40186, '0347')
    ```
    - 遠くにあるからサボった基準点は一律4500にする
    ```
    500/500
    total: 89904165
    max: (855775, '0449')
    ave: 179808.33
    min: (38421, '0026')
    ```
    - [x] self.c の値によって叩く基準を変える
      - 1,2,4,8 => 20分割、16, 32 => 15分割、64 => 10分割、128 => 8分割
      - 提出 -> https://atcoder.jp/contests/ahc018/submissions/39074311, 7,933,536 点
    ```
    500/500
    total: 85017972
    max: (839560, '0449')
    ave: 170035.944
    min: (36764, '0026')   
    ```

### 4日目
- 家の個数に応じてサンプリング点 or サボるところを変える
    - 家の個数が高々2個とかの時に、無駄 

- サンプリング、そもそも1000以上ならやめるとかも有効そう
    ```
    500/500
    total: 77800222
    max: (740878, '0449')
    ave: 155600.444
    min: (26582, '0467')
    ```
- 500以上でサボる
    ```
    500/500
    total: 72707958
    max: (749002, '0449')
    ave: 145415.916
    min: (18331, '0347')
    ```
- 400以上でサボる
    ```
    500/500
    total: 73184233
    max: (733262, '0029')
    ave: 146368.466
    min: (15923, '0347')
    ```
とりあえず500以上でサボるやつを提出 -> https://atcoder.jp/contests/ahc018/submissions/39084045 6,846,202点
 

- 掘削順序 BFSしていく(今までは雑にやっていたので、隣接マスが無いけど掘削する、みたいなセルがあった)
    ```
    500/500
    total: 72214262
    max: (744522, '0449')
    ave: 144428.524
    min: (18331, '0347')
    ```
    https://atcoder.jp/contests/ahc018/submissions/39093767 , 6,820,641点
- 焼きなましをしていきたいが、これで一旦mergeする(fieldを予測するのは達成したため)

- 山登りする
    - 水源/家/サンプリング点 を基準とし、ある頂点集合に対してクラスカル法っぽいことをして改善出来たら採用
    ```
    500/500
    total: 71794510
    max: (776548, '0449')
    ave: 143589.02
    min: (18027, '0467')
    ```
- パラメータ調整
    ```
    500/500
    total: 69613721
    max: (714448, '0449')
    ave: 139227.442
    min: (18027, '0467')
    ```
    提出する -> https://atcoder.jp/contests/ahc018/submissions/39118697, 6,419,042点

- [ ] State.destructive `Vec<Vec<bool>>` だが、無駄が多いので`BtreeSet<(usize, usize)>`にしたほうがよい...？

- [x] pythonでW, Kごとに分けて集計するように

- パラメータ調整しまくり！
    ```
    500/500
    total: 66831857
    max: (641566, '0449')
    ave: 133663.714
    min: (22408, '0332')
    ```
    https://atcoder.jp/contests/ahc018/submissions/39129966, 6,071,811点

- そもそも、山登り殆ど改善されていない
- ローカルだと山登り全くできてなかった(guessで6secくらい使っててカス)
    - initのところだけ提出して実行時間を見る -> 1.6sec まぁ...
    - guess_field_updateを実装、最初に構築した後グラフを作る -> そこに近いのは追加で叩く
    パラメータ調整しまくる
    ```
    500/500
    total: 66078047
    max: (643208, '0449')
    ave: 132156.094
    min: (21668, '0332')
    ```
    https://atcoder.jp/contests/ahc018/submissions/39135562 TLは大丈夫そう
    だが 6,302,027 点、改悪	
    -> 次この方針で上手くいかなかったらやめる
    

- グリッドで情報を持って、N*NのUnionFindをもってやる を実装する！
    - 詳細詰める
    - 水源は高々4つなので、連結か？をそれぞれ見ればよい